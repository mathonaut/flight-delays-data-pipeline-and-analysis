version: 2

models:
  # dim_air
  - name: dim_air
    description: "Dimensão de companhias aéreas utilizadas nos voos de 2015 nos EUA."
    tests:
      - not_empty
      - pk_not_null:
          pk_columns: ["srk_air"]
      - pk_unique:
          pk_columns: ["srk_air"]
      - unique_column:
          column_name: air_iat
      - not_null_columns:
          columns: ["air_iat", "air_nam"]

    columns:
      - name: srk_air
        description: "Chave substituta da companhia aérea."
      - name: air_iat
        description: "Código IATA da companhia aérea."
      - name: air_nam
        description: "Nome da companhia aérea."

  # dim_apt
  - name: dim_apt
    description: "Dimensão de aeroportos dos EUA com base nos dados de 2015."
    tests:
      - not_empty
      - pk_not_null:
          pk_columns: ["srk_apt"]
      - pk_unique:
          pk_columns: ["srk_apt"]
      - unique_column:
          column_name: apt_iat
      - not_null_columns:
          columns: ["apt_iat", "apt_nam", "cty_nam", "ste_cod"]

    columns:
      - name: srk_apt
        description: "Chave substituta do aeroporto."
      - name: apt_iat
        description: "Código IATA do aeroporto."
      - name: apt_nam
        description: "Nome do aeroporto."
      - name: cty_nam
        description: "Cidade onde o aeroporto está localizado."
      - name: ste_cod
        description: "Código do estado (sigla)."
      - name: ste_nam
        description: "Nome do estado (pode ser placeholder dependendo da origem do dado)."
      - name: lat_val
        description: "Latitude do aeroporto."
      - name: lon_val
        description: "Longitude do aeroporto."

  # dim_dat
  - name: dim_dat
    description: "Dimensão de datas derivada das observações de voo do ano de 2015."
    tests:
      - not_empty
      - pk_not_null:
          pk_columns: ["srk_dat"]
      - pk_unique:
          pk_columns: ["srk_dat"]
      - unique_column:
          column_name: ful_dat
      - not_null_columns:
          columns: ["ful_dat", "yer", "mth", "day", "dow"]

    columns:
      - name: srk_dat
        description: "Chave substituta da data."
      - name: ful_dat
        description: "Data completa utilizada como chave natural da dimensão."
      - name: yer
        description: "Ano da data."
      - name: mth
        description: "Mês correspondente."
      - name: day
        description: "Dia do mês."
      - name: dow
        description: "Dia da semana (1 = segunda, 7 = domingo)."
      - name: qtr
        description: "Trimestre do ano."
      - name: hol_flg
        description: "Indica feriados nacionais dos EUA baseados no calendário oficial de 2015."

  # fat_flt
  - name: fat_flt
    description: "Tabela fato principal contendo métricas operacionais dos voos de 2015."
    tests:
      - not_empty
      - pk_not_null:
          pk_columns: ["srk_flt"]
      - pk_unique:
          pk_columns: ["srk_flt"]

      - not_null_columns:
          columns: ["srk_dat", "srk_air", "srk_ori", "srk_dst"]

      - fk_exists:
          column: srk_air
          fk_model: ref('dim_air')
          fk_column: srk_air

      - fk_exists:
          column: srk_ori
          fk_model: ref('dim_apt')
          fk_column: srk_apt

      - fk_exists:
          column: srk_dst
          fk_model: ref('dim_apt')
          fk_column: srk_apt

      - fk_exists:
          column: srk_dat
          fk_model: ref('dim_dat')
          fk_column: srk_dat

    columns:
      - name: srk_flt
        description: "Chave substituta do registro de voo na fato."
      - name: srk_dat
        description: "FK para dim_dat."
      - name: srk_air
        description: "FK para dim_air."
      - name: srk_ori
        description: "FK para dim_apt (origem)."
      - name: srk_dst
        description: "FK para dim_apt (destino)."

      - name: sch_dep
        description: "Horário programado de partida."
      - name: dep_tme
        description: "Horário real de partida."
      - name: sch_arr
        description: "Horário programado de chegada."
      - name: arr_tme
        description: "Horário real de chegada."

      - name: dis_val
        description: "Distância do voo."
      - name: air_tme
        description: "Tempo em ar (minutos)."
      - name: elp_tme
        description: "Tempo total do voo (minutos)."
      - name: sch_tme
        description: "Tempo programado total (minutos)."

      - name: dep_dly
        description: "Atraso na partida."
      - name: arr_dly
        description: "Atraso na chegada."
      - name: sys_dly
        description: "Atraso por sistema."
      - name: sec_dly
        description: "Atraso por segurança."
      - name: air_dly
        description: "Atraso da companhia."
      - name: acf_dly
        description: "Atraso por aeronave tardia."
      - name: wea_dly
        description: "Atraso por clima."

      - name: ovn_flg
        description: "Indica se atravessou a meia-noite."
